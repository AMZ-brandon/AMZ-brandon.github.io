<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Authorization | Cedar Policy Language Version 2.3 Reference Guide</title> <meta name="generator" content="Jekyll v3.9.3" /> <meta property="og:title" content="Authorization" /> <meta property="og:locale" content="en_US" /> <link rel="canonical" href="http://localhost:4000/authorization.html" /> <meta property="og:url" content="http://localhost:4000/authorization.html" /> <meta property="og:site_name" content="Cedar Policy Language Version 2.3 Reference Guide" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Authorization" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","headline":"Authorization","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/images/Cedar1-green.png"}},"url":"http://localhost:4000/authorization.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> <div class="site-logo" role="img" aria-label="Cedar Policy Language Version 2.3 Reference Guide"></div> </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Table of contents</a></li><li class="nav-list-item"><a href="/what-is-cedar.html" class="nav-list-link">What is Cedar?</a></li><li class="nav-list-item"><a href="/terminology.html" class="nav-list-link">Terms & concepts</a></li><li class="nav-list-item"><a href="/scenario.html" class="nav-list-link">Example scenario</a></li><li class="nav-list-item active"><a href="/authorization.html" class="nav-list-link active">Authorization</a></li><li class="nav-list-item"><a href="/validation.html" class="nav-list-link">Policy validation</a></li><li class="nav-list-item"><a href="/schema.html" class="nav-list-link">Schema format</a></li><li class="nav-list-item"><a href="/templates.html" class="nav-list-link">Policy templates</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Policy syntax category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/syntax.html" class="nav-list-link">Policy syntax</a><ul class="nav-list"><li class="nav-list-item "><a href="/syntax-policy.html" class="nav-list-link">Basic syntax</a></li><li class="nav-list-item "><a href="/syntax-entity.html" class="nav-list-link">Entity</a></li><li class="nav-list-item "><a href="/syntax-datatypes.html" class="nav-list-link">Data types</a></li><li class="nav-list-item "><a href="/syntax-operators.html" class="nav-list-link">Operators</a></li><li class="nav-list-item "><a href="/syntax-grammar.html" class="nav-list-link">Grammar</a></li></ul></li><li class="nav-list-item"><a href="/security.html" class="nav-list-link">Security</a></li><li class="nav-list-item"><a href="/doc-history.html" class="nav-list-link">Document history</a></li><li class="nav-list-item"><a href="/about/" class="nav-list-link">About</a></li></ul> </nav> <p>We welcome your feedback about these docs!<br> <a href="mailto:cedar-docs@amazon.com?subject=Feedback&body=My%20name%20%28optional%29:%0D%0A%0D%0AMy%20email%20%28optional%29:%0D%0A%0D%0AWhat%20I%20was%20trying%20to%20do:%0D%0A%0D%0AWhat%20to%20make%20better:">Send feedback by email</a> or use <a href="https://github.com/cedar-policy/cedar-docs/issues">GitHub Issues</a></p> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Cedar Policy Language Version 2.3 Reference Guide" aria-label="Search Cedar Policy Language Version 2.3 Reference Guide" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 class="no_toc" id="how-cedar-authorization-works"> <a href="#how-cedar-authorization-works" class="anchor-heading" aria-labelledby="how-cedar-authorization-works"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How Cedar authorization works<a name="how-cedar-authorization-works"></a> </h1> <p>Each time a user of your application wants to perform an action on a protected resource, the application needs to invoke the Cedar authorization engine (or <em>authorizer</em>, for short) to check if this request is allowed. The authorizer considers the request against the application’s store of policies in order to make a decision, <code class="language-plaintext highlighter-rouge">Allow</code> or <code class="language-plaintext highlighter-rouge">Deny</code>. This topic discusses how the Cedar authorizer decides the answer to a particular request.</p> <h2 id="request-creation"> <a href="#request-creation" class="anchor-heading" aria-labelledby="request-creation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Request creation<a name="request-creation"></a> </h2> <p>A Cedar <em>authorization request</em> asks the question “<em>Can this principal take this action on this resource in this context?</em>”. More formally, an authorization request has four parts, abbreviated <em>PARC</em>:</p> <ul> <li><em>P</em> is the principal,</li> <li><em>A</em> is the action,</li> <li><em>R</em> is the resource, and</li> <li><em>C</em> is the request context.</li> </ul> <p><em>P</em>, <em>A</em>, and <em>R</em> are <a href="/terminology.html#term-entity">entity references</a>, while <em>C</em> is a record.</p> <p>Conceptually, you should imagine that the authorizer is able to consider <em>all</em> of your application’s policies and entity data while evaluating a request. As a practical matter, making all policies and entity data available might be too difficult or too expensive. In that case, your application needs to determine which policies and entity data are <em>relevant</em> to properly handling the request.</p> <h2 id="request-authorization"> <a href="#request-authorization" class="anchor-heading" aria-labelledby="request-authorization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Request authorization<a name="request-authorization"></a> </h2> <p>Given an authorization request, Cedar’s authorizer returns <code class="language-plaintext highlighter-rouge">Allow</code> if the request is granted or <code class="language-plaintext highlighter-rouge">Deny</code> if it is rejected, along with some diagnostics. How does it make this decision?</p> <h3 id="algorithm"> <a href="#algorithm" class="anchor-heading" aria-labelledby="algorithm"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Algorithm<a name="request-authorization-algorithm"></a> </h3> <p>First, the authorizer <em>evaluates</em> each of the policies to determine if the policy <em>satisfies</em> the request. More details about evaluation follow, but in summary, know that the evaluator can return:</p> <ul> <li><code class="language-plaintext highlighter-rouge">true</code>, when the policy satisfies the request;</li> <li><code class="language-plaintext highlighter-rouge">false</code>, when the policy does not satisfy the request; or</li> <li><code class="language-plaintext highlighter-rouge">error</code>, when there is an error when evaluating the policy on the request data.</li> </ul> <p>After evaluating each policy, the authorizer combines the results to make an authorization decision. It makes its decision by applying the following rules:</p> <ol> <li> <p>If any <code class="language-plaintext highlighter-rouge">forbid</code> policy evaluates to <code class="language-plaintext highlighter-rouge">true</code>, then the final result is <code class="language-plaintext highlighter-rouge">Deny</code>.</p> </li> <li> <p>Else, if any <code class="language-plaintext highlighter-rouge">permit</code> policy evaluates to <code class="language-plaintext highlighter-rouge">true</code>, then the final result is <code class="language-plaintext highlighter-rouge">Allow</code>.</p> </li> <li> <p>Otherwise (i.e., no policy is satisfied), the final result is <code class="language-plaintext highlighter-rouge">Deny</code>.</p> </li> </ol> <p>The authorizer returns an <em>authorization response</em>, which includes its decision along with some diagnostics. These diagnostics include the <em>determining policies</em> and any <em>error conditions</em>. If the decision is <code class="language-plaintext highlighter-rouge">Allow</code>, the determining policies are the <code class="language-plaintext highlighter-rouge">permit</code> policies that satisfy the request (rule 2). Otherwise, the determining policies are the <code class="language-plaintext highlighter-rouge">forbid</code> policies, if any, that satisfy the request (rule 1). If the decision is <code class="language-plaintext highlighter-rouge">Deny</code> because no policies were satisfied (rule 3), then the list of determining policies is empty. Whatever the final result, if the evaluation of any policies resulted in <code class="language-plaintext highlighter-rouge">error</code>, then the IDs of the erroneous policies are included in the diagnostics, too, along with the particulars of the errors.</p> <h3 id="discussion"> <a href="#discussion" class="anchor-heading" aria-labelledby="discussion"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Discussion<a name="request-authorization-discussion"></a> </h3> <p>Cedar’s authorization algorithm has three useful properties:</p> <ol> <li><strong>default deny</strong>: no request is authorized (decision <code class="language-plaintext highlighter-rouge">Allow</code>) unless there is a specific <code class="language-plaintext highlighter-rouge">permit</code> policy that grants it; by default, the decision is <code class="language-plaintext highlighter-rouge">Deny</code>.</li> <li><strong>forbid overrides permit</strong>: even if a <code class="language-plaintext highlighter-rouge">permit</code> policy is satisfied, any satisfied <code class="language-plaintext highlighter-rouge">forbid</code> policy <em>overrides</em> it, producing a <code class="language-plaintext highlighter-rouge">Deny</code> decision.</li> <li><strong>skip on error</strong>: if a policy’s evaluation returns <code class="language-plaintext highlighter-rouge">error</code>, the policy does not factor into the authorization response; it is skipped.</li> </ol> <p>Why was Cedar’s authorization algorithm designed to satisfy these properties? The first two properties make Cedar policies easier to understand. Since <code class="language-plaintext highlighter-rouge">permit</code> policies are the only way access is granted, readers just have to understand what each policy says, not what it doesn’t. Because <code class="language-plaintext highlighter-rouge">forbid</code> policies <em>always</em> deny access, readers can understand them independently of any <code class="language-plaintext highlighter-rouge">permit</code> policies created now or in the future; <code class="language-plaintext highlighter-rouge">forbid</code> policies effectively define permission “guardrails” that <code class="language-plaintext highlighter-rouge">permit</code> policies cannot cross.</p> <p>The reasoning for the skip-on-error property is more involved. An alternative authorization algorithm we considered would be to <code class="language-plaintext highlighter-rouge">Deny</code> a request when any policy evaluation exhibits an error. While this might sound good at first, deny-on-error raises concerns of <em>safety</em>. An application that was working fine with 100 policies might suddenly start denying <em>all</em> requests if the 101st policy has an error. Skip-on-error avoids this dramatic failure mode, and is more flexible: applications can always choose to look at the authorization response’s diagnostics and take a different decision if an evaluated policy produces errors. For more information, see this <a href="https://cedarland.blog/design/why-ignore-errors/content.html">blog post</a> written by one of the Cedar designers.</p> <h2 id="policy-evaluation"> <a href="#policy-evaluation" class="anchor-heading" aria-labelledby="policy-evaluation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Policy evaluation<a name="policy-evaluation"></a> </h2> <p>As just discussed, to reach its decision the Cedar authorizer’s algorithm <em>evaluates</em> a request <em>PARC</em> against each policy it is given. Evaluation returns whether or not the policy is satisfied by the request (<code class="language-plaintext highlighter-rouge">true</code>/<code class="language-plaintext highlighter-rouge">false</code>), or whether an error occurred during evaluation (<code class="language-plaintext highlighter-rouge">error</code>). How does evaluation work?</p> <h3 id="expression-evaluation"> <a href="#expression-evaluation" class="anchor-heading" aria-labelledby="expression-evaluation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Expression evaluation<a name="expression-evaluation"></a> </h3> <p>The key component of policy evaluation is <em>expression</em> evaluation. Each constraint in the policy scope is an expression. Each <code class="language-plaintext highlighter-rouge">when</code> clause also contains an expression, as does each <code class="language-plaintext highlighter-rouge">unless</code> clause. Evaluating a policy requires evaluating its constituent expressions. Example expressions include <code class="language-plaintext highlighter-rouge">resource.tags.contains("private")</code>, <code class="language-plaintext highlighter-rouge">action == Action::"viewPhoto"</code>, <code class="language-plaintext highlighter-rouge">principal in Team::"admin"</code>, and <code class="language-plaintext highlighter-rouge">resource in principal.account</code>.</p> <p>As with a typical programming language, evaluating an expression simplifies, or “executes”, the expression until no further simplification is possible. The final result is either a Cedar <em>value</em> – like <code class="language-plaintext highlighter-rouge">true</code>, <code class="language-plaintext highlighter-rouge">1</code>, <code class="language-plaintext highlighter-rouge">User::"Alice"</code>, or <code class="language-plaintext highlighter-rouge">"blue"</code> – or it is an <code class="language-plaintext highlighter-rouge">error</code>. Evaluating an expression with no variables is straightforward. The expression <code class="language-plaintext highlighter-rouge">2+2</code> evaluates to <code class="language-plaintext highlighter-rouge">4</code>. Expression <code class="language-plaintext highlighter-rouge">Action::"viewPhoto" == Action::"viewPhoto"</code> evaluates to <code class="language-plaintext highlighter-rouge">true</code>. Expression <code class="language-plaintext highlighter-rouge">if false then "blue" else "green"</code> evaluates to <code class="language-plaintext highlighter-rouge">"green"</code>. See <a href="/syntax-operators.html#syntax-operators">here</a> for complete descriptions of the various operators you can use in Cedar expressions.</p> <p>What about expressions that have variables <code class="language-plaintext highlighter-rouge">principal</code>, <code class="language-plaintext highlighter-rouge">action</code>, <code class="language-plaintext highlighter-rouge">resource</code>, and <code class="language-plaintext highlighter-rouge">context</code> in them? To evaluate such expressions the Cedar authorizer first <em>binds</em> any variables that appear in the expressions to values of the appropriate type. Then theh authorizer evaluates the expressions with those values in place of the variables.</p> <p>For example, consider the expression <code class="language-plaintext highlighter-rouge">action == Action::"viewPhoto"</code>. If the authorizer binds the <code class="language-plaintext highlighter-rouge">action</code> variable to the entity <code class="language-plaintext highlighter-rouge">Action::"viewPhoto"</code>, then the result is <code class="language-plaintext highlighter-rouge">true</code>. That’s because replacing <code class="language-plaintext highlighter-rouge">action</code> with <code class="language-plaintext highlighter-rouge">Action::"viewPhoto"</code> gives expression <code class="language-plaintext highlighter-rouge">Action::"viewPhoto" == Action::"viewPhoto"</code> which is obviously <code class="language-plaintext highlighter-rouge">true</code>.</p> <p>As another example, consider the expression <code class="language-plaintext highlighter-rouge">resource.tags.contains("Private")</code>. If the authorizer binds the <code class="language-plaintext highlighter-rouge">resource</code> variable to the entity <code class="language-plaintext highlighter-rouge">Photo::"vacation94.jpg"</code> we get <code class="language-plaintext highlighter-rouge">Photo::"vacation94.jpg".tags.contains("Private")</code>. Evaluating further, the authorizer must look up <code class="language-plaintext highlighter-rouge">Photo::"vacation94.jpg"</code> in the provided entities data, and then extract its <code class="language-plaintext highlighter-rouge">tags</code> attribute. If that attribute contains a set with the string <code class="language-plaintext highlighter-rouge">"Private"</code> in it, the result is <code class="language-plaintext highlighter-rouge">true</code>; if it’s a set without <code class="language-plaintext highlighter-rouge">"Private"</code> the result is <code class="language-plaintext highlighter-rouge">false</code>. Otherwise <code class="language-plaintext highlighter-rouge">tags</code> is either not a valid attribute or contains a non-set, and Cedar generates an <code class="language-plaintext highlighter-rouge">error</code>.</p> <h3 id="policy-satisfaction"> <a href="#policy-satisfaction" class="anchor-heading" aria-labelledby="policy-satisfaction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Policy satisfaction<a name="policy-satisfaction"></a> </h3> <p>Determining whether a policy satsifies a request is a straightforward use of expression evaluation. To explain it, let’s introduce some notation. For a policy <em>c</em>:</p> <ul> <li><em>Principal(c)</em> is the constraint involving the <code class="language-plaintext highlighter-rouge">principal</code> in <em>c</em>’s <a href="/terminology.html#term-policy">policy scope</a>. If there is no constraint on <code class="language-plaintext highlighter-rouge">principal</code>, then <em>Principal(c)</em> is <code class="language-plaintext highlighter-rouge">true</code>.</li> <li><em>Action(c)</em> is the constraint involving <code class="language-plaintext highlighter-rouge">action</code> in <em>c</em>’s policy scope. If there is no constraint on <code class="language-plaintext highlighter-rouge">action</code>, then <em>Action(c)</em> is <code class="language-plaintext highlighter-rouge">true</code>.</li> <li><em>Resource(c)</em> is the constraint involving <code class="language-plaintext highlighter-rouge">resource</code> in <em>c</em>’s policy scope. If there is no constraint on <code class="language-plaintext highlighter-rouge">resource</code>, then <em>Resource(c)</em> is <code class="language-plaintext highlighter-rouge">true</code>.</li> <li><em>Conds(c)</em> is the list of <code class="language-plaintext highlighter-rouge">when</code> and <code class="language-plaintext highlighter-rouge">unless</code> expressions in <em>c</em>.</li> </ul> <p>Here’s how the Cedar authorizer evaluates a policy <em>c</em> with respect to a <em>PARC</em> request. First, the authorizer tests whether <em>c</em> <strong>matches</strong> the request, as follows:</p> <ol> <li>Bind <code class="language-plaintext highlighter-rouge">principal</code> to <em>P</em> in expression <em>Principal(c)</em> and evaluate it</li> <li>Bind <code class="language-plaintext highlighter-rouge">action</code> to <em>A</em> in expression <em>Action(c)</em> and evaluate it</li> <li>Bind <code class="language-plaintext highlighter-rouge">resource</code> to <em>R</em> in expression <em>Resource(c)</em> and evaluate it</li> </ol> <p>If all three steps evaluate to <code class="language-plaintext highlighter-rouge">true</code>, then <em>c</em> matches the request. Otherwise it does not. (Cedar’s design ensures that none of these three steps can possibly evaluate to <code class="language-plaintext highlighter-rouge">error</code>.)</p> <p>If <em>c</em> matches the request, the authorizer evaluates the request’s conditions <em>Conds(c)</em> in order. The authorizer binds the <code class="language-plaintext highlighter-rouge">principal</code>, <code class="language-plaintext highlighter-rouge">action</code>, <code class="language-plaintext highlighter-rouge">resource</code>, and <code class="language-plaintext highlighter-rouge">context</code> variables to the <em>PARC</em> values when we do so. If all of the <code class="language-plaintext highlighter-rouge">when</code> conditions evaluate to <code class="language-plaintext highlighter-rouge">true</code>, and all of the <code class="language-plaintext highlighter-rouge">unless</code> conditions evaluate to <code class="language-plaintext highlighter-rouge">false</code>, then policy <em>c</em> satsifies the request, and the final evaluation result is <code class="language-plaintext highlighter-rouge">true</code>. If evaluating any condition expression yields <code class="language-plaintext highlighter-rouge">error</code> then policy evaluation halts at that point (any remaining conditions are skipped), and <code class="language-plaintext highlighter-rouge">error</code> is returned as the final result. Otherwise, <code class="language-plaintext highlighter-rouge">false</code> is returned.</p> <h2 id="detailed-example"> <a href="#detailed-example" class="anchor-heading" aria-labelledby="detailed-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Detailed Example<a name="policy-evaluation-example"></a> </h2> <p>To illustrate policy evaluation, consider whether a set of four policies authorizes the following request: “Can the user <code class="language-plaintext highlighter-rouge">jane</code> perform the action <code class="language-plaintext highlighter-rouge">viewPhoto</code> on the photo <code class="language-plaintext highlighter-rouge">vacation.jpg</code>?” Precisely, the request is:</p> <ul> <li><em>P</em> = <code class="language-plaintext highlighter-rouge">User::"jane"</code></li> <li><em>A</em> = <code class="language-plaintext highlighter-rouge">Action::"viewPhoto"</code></li> <li><em>R</em> = <code class="language-plaintext highlighter-rouge">Photo::"vacation.jpg"</code></li> <li><em>C</em> = <code class="language-plaintext highlighter-rouge">{}</code> (the empty record)</li> </ul> <p>Assume that the entities data includes the following details:</p> <ul> <li>Entity <code class="language-plaintext highlighter-rouge">User::"jane"</code> is a member of <code class="language-plaintext highlighter-rouge">Group::"kevinsFriends"</code></li> <li>Entity <code class="language-plaintext highlighter-rouge">Photo::"vacation.jpg"</code> has the following attributes: <ul> <li><code class="language-plaintext highlighter-rouge">.owner</code> is <code class="language-plaintext highlighter-rouge">User::"kevin"</code></li> <li><code class="language-plaintext highlighter-rouge">.tags</code> is <code class="language-plaintext highlighter-rouge">["Private","Work"]</code> (i.e., a set containing the strings <code class="language-plaintext highlighter-rouge">"Private"</code> and <code class="language-plaintext highlighter-rouge">"Work"</code>)</li> </ul> </li> </ul> <p>The Cedar authorizer evaluates each of the four policies against this request.</p> <ul> <li> <p><strong>P1</strong> – Jane can perform any action on photo <code class="language-plaintext highlighter-rouge">vacation.jpg</code>.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>permit( 
    principal == User::"jane", 
    action, 
    resource == Photo::"vacation.jpg"
);
</code></pre></div> </div> <p>This policy is <strong>satisfied</strong>.</p> <ul> <li><em>Principal</em> in P1 is <code class="language-plaintext highlighter-rouge">principal == User::"jane"</code>, so after binding <code class="language-plaintext highlighter-rouge">principal</code> to <code class="language-plaintext highlighter-rouge">User::"jane"</code> (the <em>P</em> in the request), the expression evaluates to <code class="language-plaintext highlighter-rouge">true</code>.</li> <li><em>Action</em> in P1 is simply <code class="language-plaintext highlighter-rouge">true</code> since there is no action constraint.</li> <li><em>Resource</em> in P1 is <code class="language-plaintext highlighter-rouge">resource == Photo::"vacation.jpg"</code>, so after binding <code class="language-plaintext highlighter-rouge">resource</code> to <code class="language-plaintext highlighter-rouge">Photo::"vacation.jpg"</code> (the <em>R</em> in the request), the expression evaluates to <code class="language-plaintext highlighter-rouge">true</code>.</li> <li><em>Cond(c)</em> is empty, so evaluates trivially to <code class="language-plaintext highlighter-rouge">true</code>.</li> </ul> </li> <li> <p><strong>P2</strong> – A member of group <code class="language-plaintext highlighter-rouge">kevinFriends</code> can view any of Kevin’s photos when they are tagged <code class="language-plaintext highlighter-rouge">Holiday</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>permit(
    principal in UserGroup::"kevinFriends",
    action == Action::"viewPhoto",
    resource
)
when {
    resource.tags.contains("Holiday")
};
</code></pre></div> </div> <p>This policy is <strong>not satisfied</strong>. While it matches the request, its <em>condition evaluates to <code class="language-plaintext highlighter-rouge">false</code></em>.</p> <ul> <li><em>Principal</em> in P2 is <code class="language-plaintext highlighter-rouge">principal in UserGroup::"kevinFriends"</code>, so after binding <code class="language-plaintext highlighter-rouge">principal</code> to <code class="language-plaintext highlighter-rouge">User::"jane"</code> (the <em>P</em> in the request), the expression evaluates to <code class="language-plaintext highlighter-rouge">true</code> because <code class="language-plaintext highlighter-rouge">User::"jane"</code> is a member of <code class="language-plaintext highlighter-rouge">Group::"kevinsFriends"</code></li> <li><em>Action</em> in P2 is <code class="language-plaintext highlighter-rouge">action == Action::"viewPhoto"</code>, so after binding <code class="language-plaintext highlighter-rouge">action</code> to <code class="language-plaintext highlighter-rouge">Action::"viewPhoto"</code> the expression evaluates to <code class="language-plaintext highlighter-rouge">true</code></li> <li><em>Resource</em> in P2 is simply <code class="language-plaintext highlighter-rouge">true</code> since there is no resource constraint</li> <li><em>Cond(c)</em> in P2 is the list containing <code class="language-plaintext highlighter-rouge">when</code> expression <code class="language-plaintext highlighter-rouge">resource.tags.contains("Holiday")</code>. After binding <code class="language-plaintext highlighter-rouge">resource</code> to <code class="language-plaintext highlighter-rouge">Photo::"vacation.jpg"</code> (the <em>R</em> in the request), the expression evaluates to <code class="language-plaintext highlighter-rouge">false</code> because the <code class="language-plaintext highlighter-rouge">.tags</code> attribute of <code class="language-plaintext highlighter-rouge">Photo::"vacation.jpg"</code> is <code class="language-plaintext highlighter-rouge">["Private","Work"]</code>, i.e., it does not contain <code class="language-plaintext highlighter-rouge">"Holiday"</code>.</li> </ul> </li> <li> <p><strong>P3</strong> – Users are forbidden from viewing any photos tagged <code class="language-plaintext highlighter-rouge">Private</code> unless they are the owner of the photo.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>forbid(
    principal,
    action == Action::"viewPhoto",
    resource
)
when { resource.tags.contains("Private") }
unless { principal == resource.owner };
</code></pre></div> </div> <p>This policy is <strong>satisfied</strong>.</p> <ul> <li>The policy matches the request: <code class="language-plaintext highlighter-rouge">principal</code> and <code class="language-plaintext highlighter-rouge">resource</code> are unconstrained, and <em>Action(c)</em> evaluates to <code class="language-plaintext highlighter-rouge">true</code> because <em>A</em> is <code class="language-plaintext highlighter-rouge">Action::"viewPhoto"</code>;</li> <li>The policy’s <code class="language-plaintext highlighter-rouge">when</code> condition is <code class="language-plaintext highlighter-rouge">true</code> because the <code class="language-plaintext highlighter-rouge">.tags</code> attribute of <code class="language-plaintext highlighter-rouge">Photo::"vacation.jpg"</code> contains <code class="language-plaintext highlighter-rouge">"Private"</code>; and</li> <li>The policy’s <code class="language-plaintext highlighter-rouge">unless</code> condition is <code class="language-plaintext highlighter-rouge">false</code> because the <code class="language-plaintext highlighter-rouge">.owner</code> attribute of <code class="language-plaintext highlighter-rouge">Photo::"vacation.jpg"</code> (which is <code class="language-plaintext highlighter-rouge">User::"kevin"</code>) is not equal to <em>P</em> (which is <code class="language-plaintext highlighter-rouge">User::"jane"</code>).</li> </ul> </li> <li> <p><strong>P4</strong> – Users can perform <code class="language-plaintext highlighter-rouge">updateTags</code> on a resource, like a <code class="language-plaintext highlighter-rouge">Photo</code> or <code class="language-plaintext highlighter-rouge">Album</code>, when they are the owner of the resource</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>permit(
    principal,
    action == Action::"updateTags",
    resource
)
when { principal == resource.owner };
</code></pre></div> </div> <p>This policy is <strong>not satisfied</strong>.</p> <ul> <li>The policy <strong><em>fails to match the request</em></strong> because while <code class="language-plaintext highlighter-rouge">principal</code> and <code class="language-plaintext highlighter-rouge">resource</code> are unconstrained, <em>Action(c)</em> evaluates to <code class="language-plaintext highlighter-rouge">false</code> because binding <code class="language-plaintext highlighter-rouge">action</code> to <em>A</em> yields expression <code class="language-plaintext highlighter-rouge">Action::"viewPhoto" == Action::"updatePassword"</code>.</li> </ul> </li> </ul> <p>In sum:</p> <ul> <li><code class="language-plaintext highlighter-rouge">permit</code> policy P1 evaluates to <code class="language-plaintext highlighter-rouge">true</code></li> <li><code class="language-plaintext highlighter-rouge">permit</code> policy P2 evaluates to <code class="language-plaintext highlighter-rouge">false</code></li> <li><code class="language-plaintext highlighter-rouge">forbid</code> policy P3 evaluates to <code class="language-plaintext highlighter-rouge">true</code></li> <li><code class="language-plaintext highlighter-rouge">permit</code> policy P4 evaluates to <code class="language-plaintext highlighter-rouge">false</code></li> </ul> <p>Combining these policy evaluation results, the Cedar authorizer returns a decision of <code class="language-plaintext highlighter-rouge">Deny</code>, where the determining policy is P3. This result follows from rule 1 of our <a href="#request-authorization-algorithm">authorization logic</a>: “If any forbid policy evaluates to <code class="language-plaintext highlighter-rouge">true</code>, then the final result is <code class="language-plaintext highlighter-rouge">Deny</code>” (and the determining policies are the satisfied <code class="language-plaintext highlighter-rouge">forbid</code> policies).</p> </main> <hr> <footer> <div class="d-flex mt-2"> <p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/cedar-policy/cedar-docs/tree/main/docs/authorization.md" id="edit-this-page">We welcome your feedback. You can edit this page on GitHub.</a> </p> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
